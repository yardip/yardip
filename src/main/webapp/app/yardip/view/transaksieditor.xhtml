<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="jakarta.faces.facelets"
                template="/WEB-INF/templates/editor-page.xhtml"
                xmlns:f="jakarta.faces.core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="jakarta.faces.html">

    <f:metadata>
        <ui:param name="primaryTitle" value="Editor Transaksi" />

        <ui:param name="viewPage" value="#{transaksiEditorPage}" />
        <ui:include src="/WEB-INF/components/core/base/meta/page.xhtml"/> 

        <ui:param name="notool" value="true" />
        <ui:param name="nofilter" value="true"/>

        <f:viewParam name="entity" value="#{viewPage.entity}" converter="TransaksiConverter" />
        <f:viewParam name="period" value="#{viewPage.period}" converter="AccountingPeriodConverter" />
        <f:viewParam name="cp" value="#{viewPage.copy}" converter="BooleanConverter" />
        
        <ui:param name="saveListener" value=":editor-frm" />

        <f:viewAction action="#{viewPage.load}" />
    </f:metadata>

    <ui:define name="form">       

        <div class="grid w-full p-3">
            <div class="col-12 lg:col-4 gap-3">
                <p:card class="border-1 surface-border">
                    <f:facet name="title">
                        <h:outputText value="Transaksi" />
                    </f:facet>
                    <ui:decorate template="/WEB-INF/components/core/base/form.xhtml">

                        <ui:define name="fields">

                            <div class="field ui-fluid">
                                <p:outputLabel for="jenis" value="Jenis Transaksi" />
                                <p:selectOneMenu id="jenis" value="#{viewPage.jenisTransaksi}" converter="JenisTransaksiConverter"
                                                 required="true" requiredMessage="Pilih Jenis Transaksi" >                    
                                    <f:selectItem itemLabel="Pilih Jenis Transaksi" itemValue="#{null}" />
                                    <f:selectItems value="#{jenisTransaksiList.fetchedItems}" var="item"
                                                   itemLabel="#{item.label}" itemValue="#{item}" />
                                    <p:ajax event="valueChange" listener="#{viewPage.onChangeJenis}" update="tanggal pos uraian details" />
                                </p:selectOneMenu>  
                            </div>

                            <div class="field ui-fluid">
                                <p:outputLabel for="tanggal" value="Tanggal" />
                                <p:datePicker id="tanggal" value="#{viewPage.entity.trxDate}"
                                              showOnFocus="false" showIcon="true" mindate="#{viewPage.period.fromDate}"
                                              tabindex="0" focusOnSelect="true" maxdate="#{viewPage.period.thruDate}"
                                              class="flex" required="true" 
                                              requiredMessage="Tanggal tidak boleh kosong"  >
                                    <p:ajax event="dateSelect" process="@this" />
                                </p:datePicker>
                            </div>

                            <div class="field ui-fluid">
                                <p:outputLabel for="pos" value="Kegiatan" />
                                <p:selectOneMenu id="pos"  style="min-width: auto!important"
                                                 value="#{viewPage.entity.trxType}" var="i"
                                                 converter="PosTransaksiConverter" 
                                                 disabled="#{viewPage.jenisTransaksi eq null}" 
                                                 filter="true" filterMatchMode="contains"
                                                 required="true" requiredMessage="Pilih Kegiatan" >                      
                                    <f:selectItem itemLabel="Pilih Kegiatan" itemValue="#{null}" />                      
                                    <f:selectItems value="#{viewPage.posList.fetchedItems}" var="item" itemLabel="#{item.uraian}" itemValue="#{item}" />
                                    <p:column>
                                        <h:outputText value="#{i.uraian}" />
                                    </p:column>
                                </p:selectOneMenu>  
                            </div>

                            <div class="field ui-fluid">
                                <p:outputLabel for="uraian" value="Uraian" />
                                <p:inputTextarea id="uraian" value="#{viewPage.entity.uraian}"
                                                 required="true" requiredMessage="Uraian tidak boleh kosong" /> 
                            </div>
                        </ui:define>

                    </ui:decorate>
                </p:card>
            </div>

            <h:panelGroup id="details" class="col-12 lg:col-4 gap-3">
                <p:card class="border-1 surface-border">
                    <f:facet name="title">
                        <h:outputText value="Kas" />
                    </f:facet>
                    <ui:decorate template="/WEB-INF/components/core/base/form.xhtml">

                        <ui:define name="fields">                       

                            <ui:repeat value="#{viewPage.detail}" var="detail">
                                <div class="field ui-fluid">
                                    <p:outputLabel value="#{detail.kas.name} - #{detail.kas.identifier}" />
                                    <div class="flex gap-1">
                                        <p:selectOneMenu value="#{detail.statusMutasi}"
                                                         converter="StatusMutasiKasConverter" 
                                                         class="flex-grow-0"
                                                         rendered="#{viewPage.jenisTransaksi.name() eq 'MUTASI_KAS'}" >                    
                                            <f:selectItem itemLabel="Pilih Status Mutasi" itemValue="#{null}" />
                                            <f:selectItems value="#{statusMutasiKasList.fetchedItems}" var="item"
                                                           itemLabel="#{item.label}" itemValue="#{item}" />
                                        </p:selectOneMenu>
                                        <p:inputNumber value="#{detail.tmpAmount}" decimalPlaces="2" class="flex-grow-1" />
                                    </div>
                                </div>
                            </ui:repeat>

                        </ui:define>

                    </ui:decorate>    
                </p:card>
            </h:panelGroup>  

            <div class="col-12 lg:col-4 gap-3">
                <p:card class="border-1 surface-border">
                    <f:facet name="title">
                        <h:outputText value="Bukti Kas" />
                    </f:facet>
                    <div class="flex flex-column">
                        <ui:decorate template="/WEB-INF/components/core/base/form.xhtml">
                            <ui:define name="fields">   
                                <div class="field ui-fluid">
                                    <p:outputLabel for="bk" value="No. BK" />
                                    <p:inputText id="bk" value="#{viewPage.entity.trxDocId}" readonly="true" /> 
                                </div>

                                <div class="field ui-fluid">
                                    <p:fileUpload id="dokumen" listener="#{viewPage.onUploadBuktiKas}" 
                                                  mode="simple" label="Unggah"  skinSimple="true" dragDropSupport="false"
                                                  chooseIcon="pi pi-upload" multiple="true" auto="true" process="@this"
                                                  update="messages buktiKasTbl" class="fileupload">
                                        <p:validateFile sizeLimit="10000000" fileLimit="3" allowTypes="/(\.|\/)(gif|jpeg|jpg|png|pdf|doc|docx|xls|xlsx)$/" />
                                    </p:fileUpload>
                                </div>
                                <ui:decorate template="/WEB-INF/components/core/base/table-direct.xhtml" >
                                    <ui:param name="dataView" value="#{viewPage.buktiKasList}" />
                                    <ui:param name="styleClass" value="flex-grow-1" />
                                    <ui:param name="rendered" value="true" />
                                    <ui:define name="columns">
                                        <p:column headerText="Dokumen">
                                            <h:outputText value="#{data.name}" class="white-space-normal font-semibold text-xs" />
                                        </p:column>
                                        <p:column headerText="Tipe">
                                            <h:outputText value="#{data.contentType}" class="white-space-normal font-semibold text-xs" />
                                        </p:column>
                                    </ui:define>
                                </ui:decorate>
                            </ui:define>
                        </ui:decorate>
                    </div>
                </p:card>
            </div>
        </div>

    </ui:define>

</ui:composition>
